cleanup(){ rm -rf "$target" "$target.tmp";};trap cleanup INT EXIT;case "$(uname -s)" in Darwin*)mac=1;;esac;target="$(mktemp -d -p . DDLC-MAS-XXXXXX)";set -e;id="$(curl -sL "$(curl -sL -H "Content-Type: application/x-www-form-urlencoded" -d "" https://teamsalvato.itch.io/ddlc/download_url|perl -lne 'if(/"url":"(.+?)"/){$u=$1;$u=~s/\\\//\//g;print $u}')"|perl -lne '$in=join("",<STDIN>);while($in=~/<a[^\/]*data-upload_id="(.+?)".*?<\/a>/g){print $1}')";nid="$(echo "$id"|wc -l)";if [ "$nid" -eq 0 ];then exit 2;elif [ "$nid" -eq 1 ];then if [ -n "$mac" ];then exit 2;fi;cid="$(echo "$id"|head -n 1)";else if [ -n "$mac" ];then cid="$(echo "$id"|tail -n 1)";else cid="$(echo "$id"|head -n 1)";fi;fi;curl -L "$(curl -sL -H "Content-Type: application/x-www-form-urlencoded" -d "" "https://teamsalvato.itch.io/ddlc/file/$cid"|perl -lne 'if(/"url":"(.+?)"/){$u=$1;$u=~s/\\\//\//g;print $u}')" -o "$target.tmp";unzip -o -q "$target.tmp" -d "$target";rm "$target.tmp";nested="$(find "$target" -mindepth 1 -maxdepth 1 -type d)";mv "$nested" "$target.tmp";rm -d "$target";mv "$target.tmp" "$target";nested=;if [ ! -d "$target" ];then exit 2;fi;mas_url="$(curl -sL https://api.github.com/repos/monika-after-story/monikamoddev/releases/latest|perl -lne 'print $1 if /"browser_download_url": "(.+?-Mod\.zip)"/')";curl -L "$mas_url" -o "$target.tmp";unzip -o -q "$target.tmp" -d "$target/game";rm "$target.tmp";if [ -d "Monika After Story" ];then mv "$target" "Monika After Story";fi;trap - INT EXIT
